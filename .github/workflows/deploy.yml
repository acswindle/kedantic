name: Publish to PyPI

on:
  push:
    branches: [main]  # Triggers on merge into main

jobs:
  publish:
    runs-on: ubuntu-latest
    environment: pypi  # Optional: for approval/protection rules
    permissions:
      id-token: write   # Required for Trusted Publishing
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v3  # Or latest version

      - name: Set up Python
        run: uv python install  # Uses your project's Python version, or specify e.g. 3.12

      - name: Build package
        run: uv build  # Creates dist/*.whl and dist/*.tar.gz

      # Optional: Basic smoke test to verify built artifacts
      - name: Smoke test wheel
        run: uv run --isolated --no-project --with dist/*.whl pytest tests/  # Adjust to your tests

      - name: Publish to PyPI
        run: uv publish  # Uses Trusted Publishing automatically
